import{S as ot,P as nt,W as at,O as it,d as st,M as I,e as W,R as N,D as _,f as X,B as z,a as p,b as B,c as O,A as rt}from"./OrbitControls-Bmc_7HC8.js";const y=document.getElementById("galaxy-view"),g=new ot,w=new nt(60,y.clientWidth/y.clientHeight,.1,1e3),M=new at({antialias:!0});M.setSize(y.clientWidth,y.clientHeight);M.setPixelRatio(window.devicePixelRatio);y.appendChild(M.domElement);const j=new it(w,M.domElement);j.enableDamping=!0;const f=30,x=3,C=6,D=12e3,A=8e3;let l=!0;function E(e){return e<x?e/x:Math.sqrt(x/e)}function L(e){return e<x?e/x:.85+.15*Math.exp(-e/20)}const ct=new st(.5,32,32),lt=new I({color:0}),dt=new W(ct,lt);g.add(dt);const ht=new N(.6,1.5,64),ut=new I({color:16755268,side:_,transparent:!0,opacity:.8}),V=new W(ht,ut);V.rotation.x=Math.PI/2;g.add(V);const ft=new N(.55,.8,64),gt=new I({color:16777164,side:_,transparent:!0,opacity:.9}),U=new W(ft,gt);U.rotation.x=Math.PI/2;g.add(U);const Y=new X(16772812,3,60);g.add(Y);const J=new X(16755302,1.5,30);J.position.set(0,.5,0);g.add(J);const G=new z,S=new Float32Array(A*3),v=new Float32Array(A*3),K=new Float32Array(A),Q=[];for(let e=0;e<A;e++){const t=Math.pow(Math.random(),2)*C,a=Math.random()*Math.PI*2,o=Math.acos(2*Math.random()-1),s=t*Math.sin(o)*Math.cos(a),r=t*Math.cos(o)*.6,n=t*Math.sin(o)*Math.sin(a);S[e*3]=s,S[e*3+1]=r,S[e*3+2]=n;const h=Math.random();v[e*3]=1,v[e*3+1]=.8-h*.3,v[e*3+2]=.5-h*.3,K[e]=.1+(1-t/C)*.15;const c=Math.sqrt(s*s+n*n)||.1;Q.push({radius:c,angle:Math.atan2(n,s),angularVelocity:L(c)/c*.025,keplerianAngularVelocity:E(c)/c*.025,y:r})}G.setAttribute("position",new p(S,3));G.setAttribute("color",new p(v,3));G.setAttribute("size",new p(K,1));const yt=new B({size:.12,vertexColors:!0,transparent:!0,opacity:.95,sizeAttenuation:!0}),R=new O(G,yt);g.add(R);const F=new z,P=new Float32Array(D*3),T=new Float32Array(D*3),Z=[];for(let e=0;e<D;e++){const a=Math.floor(Math.random()*2)*Math.PI,o=C+Math.pow(Math.random(),.6)*(f-C),s=a+o/f*Math.PI*2.5,r=(Math.random()-.5)*.6,n=s+r,h=(Math.random()-.5)*.3*Math.exp(-o/15);P[e*3]=Math.cos(n)*o,P[e*3+1]=h,P[e*3+2]=Math.sin(n)*o;const c=Math.random();T[e*3]=.7+c*.3,T[e*3+1]=.8+c*.2,T[e*3+2]=.9+c*.1,Z.push({radius:o,angle:n,angularVelocity:L(o)/o*.02,keplerianAngularVelocity:E(o)/o*.02,height:h})}F.setAttribute("position",new p(P,3));F.setAttribute("color",new p(T,3));const mt=new B({size:.15,vertexColors:!0,transparent:!0,opacity:.9}),H=new O(F,mt);g.add(H);const $=new z,tt=3e3,k=new Float32Array(tt*3);for(let e=0;e<tt;e++)k[e*3]=(Math.random()-.5)*400,k[e*3+1]=(Math.random()-.5)*400,k[e*3+2]=(Math.random()-.5)*400;$.setAttribute("position",new p(k,3));const wt=new O($,new B({color:16777215,size:.3}));g.add(wt);g.add(new rt(1118498));w.position.set(0,35,50);w.lookAt(0,0,0);window.toggleRotation=function(){l=!l;const e=document.getElementById("toggleBtn"),t=document.querySelector(".button-hint"),a=document.getElementById("modeIndicator"),o=a.querySelector(".mode-dot");l?(e.textContent="Show Expected Motion",e.classList.remove("expected"),t.innerHTML="Click to see what the galaxy SHOULD look like.<br>Watch the outer stars slow down!",o.classList.remove("expected"),o.classList.add("observed"),a.querySelector("span").textContent="Showing: OBSERVED (the mystery)"):(e.textContent="Show Observed Motion",e.classList.add("expected"),t.innerHTML="Now showing EXPECTED motion (Newton's prediction).<br>Click to see ACTUAL observations!",o.classList.remove("observed"),o.classList.add("expected"),a.querySelector("span").textContent="Showing: EXPECTED (Newton predicts)"),q()};function q(){const e=document.getElementById("chart"),t=e.getContext("2d"),a=e.width=e.clientWidth*2,o=e.height=e.clientHeight*2;t.scale(2,2);const s=a/2,r=o/2,n=40;t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(0,0,s,r),t.strokeStyle="#444",t.lineWidth=1,t.beginPath(),t.moveTo(n,n),t.lineTo(n,r-n),t.lineTo(s-n,r-n),t.stroke(),t.fillStyle="#888",t.font="11px Arial",t.fillText("Velocity",n-35,n+20),t.fillText("Distance from center",s/2-40,r-10);const h=s-n*2,c=r-n*2;t.strokeStyle=l?"#44ff44":"#88ff88",t.lineWidth=l?2:3,t.setLineDash(l?[]:[]),t.beginPath();for(let i=0;i<=100;i++){const d=i/100*f,m=E(d),u=n+d/f*h,b=r-n-m*c;i===0?t.moveTo(u,b):t.lineTo(u,b)}t.stroke(),t.setLineDash([]),t.strokeStyle=l?"#ff4444":"#ff8888",t.lineWidth=l?3:2,t.beginPath();for(let i=0;i<=100;i++){const d=i/100*f,m=L(d),u=n+d/f*h,b=r-n-m*c;i===0?t.moveTo(u,b):t.lineTo(u,b)}t.stroke(),t.fillStyle="rgba(255, 100, 100, 0.15)",t.beginPath();for(let i=0;i<=100;i++){const d=i/100*f,m=n+d/f*h,u=r-n-L(d)*c;i===0?t.moveTo(m,u):t.lineTo(m,u)}for(let i=100;i>=0;i--){const d=i/100*f,m=n+d/f*h,u=r-n-E(d)*c;t.lineTo(m,u)}t.closePath(),t.fill(),t.fillStyle="#ff6666",t.font="bold 12px Arial",t.fillText("THE GAP",s-n-60,r/2-20),t.font="10px Arial",t.fillStyle="#aa4444",t.fillText("Dark matter?",s-n-60,r/2-5),t.fillStyle=l?"#ff6666":"#66ff66",t.font="bold 11px Arial",t.fillText(l?"SHOWING: Observed":"SHOWING: Expected",n,n-10)}q();function et(){requestAnimationFrame(et),V.rotation.z+=.02,U.rotation.z-=.03;const e=H.geometry.attributes.position.array;for(let a=0;a<D;a++){const o=Z[a],s=l?o.angularVelocity:o.keplerianAngularVelocity;o.angle+=s,e[a*3]=Math.cos(o.angle)*o.radius,e[a*3+2]=Math.sin(o.angle)*o.radius}H.geometry.attributes.position.needsUpdate=!0;const t=R.geometry.attributes.position.array;for(let a=0;a<A;a++){const o=Q[a];if(o.radius>.5){const s=l?o.angularVelocity:o.keplerianAngularVelocity;o.angle+=s,t[a*3]=Math.cos(o.angle)*o.radius,t[a*3+2]=Math.sin(o.angle)*o.radius}}R.geometry.attributes.position.needsUpdate=!0,Y.intensity=3+Math.sin(Date.now()*.003)*.5,j.update(),M.render(g,w)}et();window.addEventListener("resize",()=>{w.aspect=y.clientWidth/y.clientHeight,w.updateProjectionMatrix(),M.setSize(y.clientWidth,y.clientHeight),q()});
